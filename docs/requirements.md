# Arknights: Endfield 抽卡规划模拟器 需求文档

> 本文档定义产品需求规范，不包含具体实现细节。

## 1. 背景与目标

### 1.1 产品概述
- 产品名称：Endfield Gacha Calculator
- 形态：网页应用（单页应用）
- 功能：接受用户输入当前/未来资源与版本规划，在固定卡池机制下，按指定策略进行 Monte Carlo 模拟，输出结果分布与风险指标

### 1.2 目标与约束
- **中国大陆可访问**
- **不带来云服务成本**（不使用后端计算、数据库、付费 API）
- **架构简单**（纯静态站点）
- **模拟运算在用户浏览器侧完成**（主线程 + Web Worker 方案，避免卡顿）

### 1.3 MVP 不做范围（明确排除）
- 不做登录/账号体系
- 不做云端存档（不上传用户输入）
- 不做运营后台
- 不做付费、广告

## 2. 用户与使用场景（User Stories）

- 作为用户，我可以输入：
  - 当前可用于抽卡的资源折算值（例如"可抽次数"）
  - 当前武库配额
  - 未来每个版本的资源获得量
  - 规划的版本数、每版本卡池数
  - 选择一个预置抽卡策略
  - 设置模拟次数（trials）
- 我点击"开始模拟"后，能看到：
  - 达成目标的概率统计
  - 平均消耗、剩余资源分布
  - P50/P90/P99 等分位点
  - 角色和专武获取期望与分布
  - 与保底/井相关的统计

## 3. 功能需求

### 3.1 输入模块（表单）

#### 3.1.1 资源输入
- 当前角色抽数
  - 字段：`currentPulls`
  - 类型：number（>= 0，整数）
- 当前武库配额
  - 字段：`currentArsenal`
  - 类型：number（>= 0，整数）

#### 3.1.2 规划输入
- 每版本获得角色抽数
  - 字段：`pullsPerVersion`
  - 类型：number（>= 0，整数）
- 每版本获得武库配额
  - 字段：`arsenalPerVersion`
  - 类型：number（>= 0，整数）
- 规划版本数
  - 字段：`versionCount`
  - 类型：number（1-8，整数）
- 每版本卡池数
  - 字段：`bannersPerVersion`
  - 类型：number（1-3，整数）

- （可选）第一个版本不计入版本资源
  - 字段：`excludeFirstVersionResources`
  - 类型：boolean
  - 说明：用于表示“第一个版本的版本福利资源已获取/已花掉，因此不再计入版本资源，只计算后续版本可以获得的资源”

#### 3.1.3 策略选择
- 基础策略
  - 字段：`strategyId`
  - 类型：string（'S1' | 'S2'）
- 附加策略
  - A1: 永远使用情报书和卡池赠送（默认开启）
  - A2: 凑加急寻访（默认关闭）
  - A3: 凑情报书（默认关闭）
  - A4: 最后版本用光所有资源（默认关闭）
  - A5: 武器井优先（默认开启）

#### 3.1.4 模拟参数
- 模拟次数
  - 字段：`trials`
  - 类型：number（1000 | 5000 | 10000 | 20000）
- 随机种子（可复现）
  - 字段：`seed`
  - 类型：string | null

### 3.2 模拟引擎

#### 3.2.1 核心功能
- 所有模拟在浏览器侧执行
- 支持 Web Worker 避免 UI 主线程卡顿
- 纯函数设计，便于测试与复现
- 支持随机种子，确保结果可复现

### 3.3 输出与展示

#### 3.3.1 核心指标
- 角色获取期望与分布
- 专武获取期望与分布
- 角色完全覆盖率（获得所有角色的概率）
- 专武完全覆盖率（获得所有专武的概率）
- 平均消耗抽数 / 平均消耗武库配额
- 分位点：P50 / P90 / P99（消耗）
- 资源来源明细（用于 UI 悬浮提示）
  - 抽数来源：版本福利、卡池赠送、加急寻访、寻访情报书（期望）等
  - 武库配额来源：版本福利、角色池抽卡转化（期望）等

#### 3.3.2 分布可视化
- 角色获取数量分布图（柱状图）
- 专武获取数量分布图（柱状图）
- 累积百分比总结

### 3.4 运行态交互
- 点击"开始模拟"后：
  - 显示运行中状态
  - 显示进度（已完成 trial 数/总数）
  - 支持取消（终止 Worker）
- 输入校验：非负、整数、范围限制等

### 3.5 第二分页：全图鉴 0+1 充值估算

- 目标：估算在“全图鉴 0+1（角色池抽到UP才收手；武器池抽到专武才收手）”场景下，所需补抽/充值资源的分布
- 输入：复用 3.1 的资源输入与规划输入（含 `excludeFirstVersionResources`）与 trials
- 规则：充值按“用到时补齐”计算（当余额不足以继续消耗时，立即注入刚好够用的数量）
- 输出：
  - 不充值可获得资源（抽数为确定值；武库配额为期望值，因为来自抽卡的配额是随机的）
  - 充值需求（抽数/武库配额）的期望值、中位数与分布

## 4. 非功能需求

### 4.1 成本与架构
- 纯静态站点，不需要服务器计算
- 不依赖数据库与云函数
- 构建产物：标准静态文件（index.html + assets/*）

### 4.2 可访问性（中国大陆）
- 页面不依赖被墙 CDN 的运行时资源
- 构建产物尽量小、请求数尽量少

### 4.3 隐私
- 不上传用户输入
- 可选：使用 localStorage 保存表单

### 4.4 兼容性
- 主要兼容 Chromium 内核浏览器
- 移动端可用（基础响应式）

## 5. 部署方案（0 成本优先）

> MVP 输出必须是标准静态构建产物（`index.html` + `assets/*`），便于迁移到任何托管。

可选部署方式：
1. 任意静态文件托管（最通用）：上传构建产物即可
2. GitHub Pages：免费、简单，但大陆访问稳定性不保证
3. 国内静态托管（如 Gitee Pages 等）：通常大陆更稳
4. 自有设备/NAS：0 额外云成本，但需要自行解决公网访问

## 6. 目标定义

### 6.1 单目标场景
- 在规划期内获得至少1个限定角色

### 6.2 统计指标
- 角色获取数量期望与分布
- 专武获取数量期望与分布
- 资源消耗统计（抽数、武库配额）
- 成功率与覆盖率分析

---

**文档版本**: v1.2
**最后更新**: 2026-02-07
**维护者**: Claude + User
