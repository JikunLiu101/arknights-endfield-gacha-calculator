# Arknights: Endfield 抽卡规划模拟 Web App（MVP）

> 本文档用于将想法落地为可实现的 MVP 需求与 3 小时从 0 到上线计划。
> 
> 说明：**固定卡池机制**与**给定抽卡策略**的细节将由作者后续补充；本文先提供可实现的接口与占位结构，确保工程可先搭起来。

## 1. 背景与目标

### 1.1 产品概述
- 产品名称（暂定）：Endfield Gacha Calculator
- 形态：网页 App（单页优先）
- 功能：接受用户输入当前/未来资源与版本规划，在固定卡池机制下，按指定策略进行 Monte Carlo 模拟，输出结果分布与风险指标。

### 1.2 目标与约束
- **中国大陆可访问**
- **不带来云服务成本**（不使用后端计算、数据库、付费 API）
- **架构简单**（纯静态站点）
- **模拟运算在用户浏览器侧完成**（默认主线程 + Web Worker 方案，避免卡顿）

### 1.3 MVP 不做范围（明确排除）
- 不做登录/账号体系
- 不做云端存档（不上传用户输入）
- 不做运营后台
- 不做付费、广告

## 2. 用户与使用场景（User Stories）

- 作为用户，我可以输入：
  - 当前可用于抽卡的资源折算值（例如“可抽次数”）
  - 未来每个版本的资源获得量（可先用“每版本固定 X 抽”）
  - 规划的版本数、每版本卡池数
  - 选择一个预置抽卡策略
  - 设置模拟次数（trials）
- 我点击“开始模拟”后，能看到：
  - 达成目标（例如：在规划内至少获得目标一次）的概率
  - 平均消耗、剩余资源分布
  - P50/P90/P99 等分位点
  - 与保底/歪/必中相关的统计（若机制存在）

## 3. 功能需求

### 3.1 输入模块（表单）

#### 3.1.1 资源输入
- 当前资源（折算为抽数）
  - 字段：`currentPulls`
  - 类型：number（>= 0，整数）
- 未来版本资源（MVP 先简化）
  - 方案 A（MVP）：每版本固定获得抽数
    - 字段：`pullsPerVersion`
    - 类型：number（>= 0，整数）
  - 方案 B（后续）：逐版本列表
    - 字段：`pullsByVersion[]`

#### 3.1.2 版本规划
- 规划版本数
  - 字段：`versionCount`
  - 类型：number（>= 1，整数）
- 每版本卡池数
  - 字段：`bannersPerVersion`
  - 类型：number（>= 1，整数）

> MVP 默认：卡池按顺序依次出现，不考虑持续时间与重叠。

#### 3.1.3 策略选择
- 预置策略
  - 字段：`strategyId`
  - 类型：string（枚举）
- （可选）策略参数
  - 例如：每池最大抽数、止损阈值、目标池优先级等

> 策略细节由作者后续补充；工程上应支持“策略=纯函数 + 可选参数”。

#### 3.1.4 模拟参数
- 模拟次数
  - 字段：`trials`
  - 类型：number（建议默认 10_000；上限可设 200_000 防止卡死）
- 随机种子（可复现）
  - 字段：`seed`
  - 类型：string | empty

### 3.2 模拟引擎

#### 3.2.1 设计原则
- 所有模拟在浏览器侧执行
- 机制与策略解耦：
  - 机制模块：只负责“给定抽数预算与 RNG，返回抽卡结果/状态变化”
  - 策略模块：只负责“如何在不同卡池/版本之间分配抽数”
- 纯函数优先，便于测试与复现
- 支持 Web Worker：避免 UI 主线程卡顿

#### 3.2.2 核心接口（占位定义）
- `simulatePlan(planInput, strategy, gachaModel, rng) -> PlanOutcome`
- `simulateBanner(bannerState, pullCount, gachaModel, rng) -> BannerOutcome`
- `gachaModel`（固定机制）：由作者补充具体规则与参数（保底、UP、跨池继承等）

### 3.3 输出与展示

#### 3.3.1 概览指标
- 达成目标概率（如：至少获得目标 1 次）
- 平均消耗抽数 / 平均剩余抽数
- 分位点：P50 / P90 / P99（消耗或剩余）

#### 3.3.2 分布可视化（MVP 简洁）
- 直方图：拿到目标所需抽数（或剩余抽数）
- 或累计分布（CDF）

> MVP 可用简单 SVG/Canvas 绘制；不强制引入重型图表库。

#### 3.3.3 机制相关统计（视机制而定）
- 保底触发次数分布
- 歪/必中次数（若存在）

### 3.4 运行态交互
- 点击“开始模拟”后：
  - 立即显示运行中状态
  - 显示进度（可粗粒度：已完成 trial 数）
  - 支持取消（终止 Worker）
- 输入校验：非负、整数、上限等

## 4. 非功能需求

### 4.1 成本与架构
- 纯静态站点，不需要服务器计算
- 不依赖数据库与云函数

### 4.2 可访问性（中国大陆）
- 页面不依赖被墙 CDN 的运行时资源
- 构建产物尽量小、请求数尽量少

### 4.3 隐私
- 不上传用户输入
- 可选：使用 `localStorage` 保存表单（默认可不做，或做开关）

### 4.4 兼容性
- 主要兼容 Chromium 内核浏览器
- 移动端可用（基础响应式）

## 5. 部署方案（0 成本优先）

> MVP 输出必须是标准静态构建产物（`index.html` + `assets/*`），便于迁移到任何托管。

可选部署方式：
1. 任意静态文件托管（最通用）：上传构建产物即可
2. GitHub Pages：免费、简单，但大陆访问稳定性不保证
3. 国内静态托管（如 Gitee Pages 等）：通常大陆更稳；是否免费与可用性需上线时确认
4. 自有设备/NAS：0 额外云成本，但需要你自己解决公网访问

## 6. 3 小时从 0 到上线计划（时间盒）

### 0:00 - 0:15 项目初始化
- 选型：Vite + TypeScript（快速构建、产物纯静态）
- 初始化项目与基础页面
- 目标产出：本地可启动开发环境，能构建静态产物

### 0:15 - 0:45 数据模型与接口定义
- 定义输入/输出 schema
- 定义机制与策略的接口（先用占位规则跑通）
- 目标产出：可在控制台跑一次完整模拟流程（简化概率也可）

### 0:45 - 1:30 实现模拟引擎（核心）
- 实现 RNG（支持 seed）
- 实现单池模拟与跨池/跨版本 runner（机制细节后续替换）
- 实现 2~3 个预置策略（规则后续补齐）
- 加入 Web Worker（推荐此阶段完成，避免返工）
- 目标产出：固定 seed 可复现结果；性能在 1e4 trials 可接受

### 1:30 - 2:15 实现 UI（单页闭环）
- 表单 + 校验
- “开始/取消”按钮与运行状态
- 结果展示：概览指标 + 简单分布图 + 统计表
- 目标产出：用户完整闭环可用

### 2:15 - 2:40 体验与容错
- trials 过大时提示降档
- Worker 错误处理与边界输入处理
- 数值格式化（百分比/分位点）
- 目标产出：可公开给他人试用的最低体验

### 2:40 - 3:00 构建与部署
- 产出静态构建包
- 选择一个 0 成本托管渠道部署
- 目标产出：可访问 URL 或可离线打开的静态页面

## 7. 待补充信息（作者后续提供）

> 以下信息会决定模拟结果是否“真实”，但不影响工程脚手架与架构先行。

1. 固定卡池机制：
   - 基础出货率
   - 保底阈值与规则
   - UP/歪/必中规则
   - 跨池继承（是否共享计数）
   - 不同池（角色/武器等）是否存在不同规则
2. 给定抽卡策略列表：
   - 每个策略的一句话描述
   - 是否带参数（如每池最大抽数、止损阈值、目标优先级）
3. “目标”定义：
   - 单目标/多目标
   - 达成条件（至少 1 次 / 指定数量 / 指定组合）
